{% extends 'base.html' %}
{% block title %} Resume Analyzer {% endblock %}
{% block content%} 
<!-- Put this in your template (requires Bootstrap 5 CSS + optional Bootstrap JS) -->
<h3>Upload your resume</h3>

<form enctype="multipart/form-data" method="post" class="container mt-4">
  <div class="row g-3 align-items-stretch"> <!-- align-items-stretch lets columns match height -->
    <!-- LEFT: Dropzone box -->
    <div class="col-md-6 d-flex">
      <div id="dropzone" class="w-100 dropzone d-flex flex-column align-items-center justify-content-center p-4"
           role="button" tabindex="0" aria-label="Upload resume (click or drag and drop)">
        <!-- hidden file input -->
        <input type="file" name="file" id="fileInput" class="d-none" accept=".pdf,.doc,.docx" />

        <!-- visible box content -->
        <div class="text-center">
          <!-- inline upload SVG icon -->
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="mb-2"
               viewBox="0 0 16 16" aria-hidden="true" focusable="false">
            <path d="M.5 9.9V13a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1V9.9a.5.5 0 0 0-1 0V13H1.5V9.9a.5.5 0 0 0-1 0z"/>
            <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V10.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
          </svg>

          <div id="dzText">
            <strong>Drop your resume here</strong>
            <div class="small text-muted">or click to browse (PDF/DOC)</div>
            <div id="selectedFile" class="small mt-2 text-truncate" style="max-width:240px;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Job info (title / company / description) -->
    <div class="col-md-6 d-flex">
      <div class="w-100 d-flex flex-column p-3 border rounded h-100">
        <div class="mb-3">
          <label for="job_title" class="form-label">Job Title</label>
          <input type="text" name="job_title" id="job_title" class="form-control" placeholder="e.g. Software Engineer">
        </div>

        <div class="mb-3">
          <label for="company" class="form-label">Company Name</label>
          <input type="text" name="company" id="company" class="form-control" placeholder="e.g. Google">
        </div>

        <div class="mb-3 flex-grow-1 d-flex flex-column">
          <label for="description" class="form-label">Job Description</label>
          <textarea name="description" id="description" class="form-control flex-grow-1" rows="6"
                    placeholder="Enter job description here..."></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Submit button -->
  <div class="row mt-3">
    <div class="col text-center">
      <button type="submit" class="btn btn-primary">Analyse Resume</button>
    </div>
  </div>
</form>

<!-- Styles -->
<style>
  .dropzone {
    border: 2px dashed #ced4da;
    border-radius: 8px;
    background: rgba(0,0,0,0.01);
    transition: background .15s, border-color .15s;
    min-height: 100%; /* tries to fill column height */
    text-align: center;
  }

  .dropzone.dragover {
    background: rgba(0, 123, 255, 0.04);
    border-color: #0d6efd;
  }

  /* make sure the right-side container defines the height for stretch */
  .col-md-6 > .h-100 { height: 100%; }
</style>

<!-- JS: drag & drop + click-to-open file browser -->
<script>
  (function() {
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const selectedFile = document.getElementById('selectedFile');

    // Helper to show selected file name
    function showFileName(file) {
      if (!file) {
        selectedFile.textContent = '';
        return;
      }
      selectedFile.textContent = file.name + ' (' + Math.round(file.size/1024) + ' KB)';
    }

    // Click or keyboard activation triggers file chooser
    dropzone.addEventListener('click', () => fileInput.click());
    dropzone.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        fileInput.click();
      }
    });

    // When user chooses by browser dialog
    fileInput.addEventListener('change', (e) => {
      if (e.target.files && e.target.files[0]) {
        showFileName(e.target.files[0]);
      } else {
        showFileName(null);
      }
    });

    // Drag events
    ['dragenter', 'dragover'].forEach(ev => {
      dropzone.addEventListener(ev, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.add('dragover');
      });
    });

    ['dragleave', 'dragend', 'mouseout'].forEach(ev => {
      dropzone.addEventListener(ev, (e) => {
        dropzone.classList.remove('dragover');
      });
    });

    // Drop handler
    dropzone.addEventListener('drop', (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropzone.classList.remove('dragover');

      const dt = e.dataTransfer;
      if (!dt) return;

      const files = dt.files;
      if (!files || files.length === 0) return;

      // Only take first file (you can modify to accept multiple)
      const file = files[0];

      // Validate basic type (optional)
      // Allowed extensions: pdf, doc, docx
      const allowed = ['application/pdf',
                       'application/msword',
                       'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
      // Many browsers give generic MIME types; optionally check extension:
      const ext = file.name.split('.').pop().toLowerCase();
      const extAllowed = ['pdf','doc','docx'];

      if (!allowed.includes(file.type) && !extAllowed.includes(ext)) {
        alert('Unsupported file type. Please upload PDF or DOC/DOCX.');
        return;
      }

      // Put file into the hidden file input using a DataTransfer (works in modern browsers)
      const dataTransfer = new DataTransfer();
      dataTransfer.items.add(file);
      fileInput.files = dataTransfer.files;

      showFileName(file);
    });

    // Accessibility: prevent unexpected behaviour on focus out
    dropzone.addEventListener('blur', () => dropzone.classList.remove('dragover'));
  })();
</script>


{% if score %}
<p>Score: {{score}}</p>
<style>
.progress-bar {
  width: var(--progress-width);
}
</style>

<div class="progress-bar" style="--progress-width: {{ score }}%;"
     role="progressbar" aria-valuenow="{{ score }}" aria-valuemin="0" aria-valuemax="100">
  {{ score }}%
</div>
{% endif %}
{% endblock %}